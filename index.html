<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lion Simple Widget</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            /* ä¿æŒæŸ”å’Œçš„åŠ¨æ€èƒŒæ™¯ï¼Œé¿å…ç”»é¢è¿‡äºå•è°ƒ */
            background: linear-gradient(-45deg, #e0c3fc, #8ec5fc, #90f7ec, #ffecd2);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* æç®€èˆå° */
        .stage {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        /* ç‹®å­ä¸»ä½“ - æ”¾å¤§å±•ç¤º */
        #pet-image {
            width: 85%; /* æ›´å¤§çš„å æ¯” */
            max-width: 320px;
            height: auto;
            max-height: 80%;
            object-fit: contain;
            cursor: pointer;
            transition: transform 0.1s;
            filter: drop-shadow(0 10px 25px rgba(0,0,0,0.15));
        }
        #pet-image:active { transform: scale(0.92); }

        /* --- æ¼‚æµ®æ–‡å­—æ ·å¼ç³»ç»Ÿ --- */
        .floater {
            position: absolute;
            font-weight: 800;
            animation: floatUp 1.2s forwards;
            pointer-events: none;
            z-index: 100;
            white-space: nowrap;
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
        }
        
        /* ç‚¹å‡»æ™®é€šå¥–åŠ± */
        .floater.gain { 
            color: #4CAF50; 
            font-size: 1.4rem; 
        }

        /* è¢«åŠ¨æ”¶ç›Šå¥–åŠ± */
        .floater.passive {
            color: #FF9800;
            font-size: 1.1rem;
            animation: floatUpSlow 2s forwards; /* æ…¢ä¸€ç‚¹ */
        }

        /* æš´å‡»/æ—¶é•¿å¥–åŠ± */
        .floater.bonus {
            color: #6200EA;
            font-size: 1.3rem;
            background: rgba(255,255,255,0.8);
            padding: 4px 10px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        @keyframes floatUp {
            0% { opacity: 0; transform: translate(-50%, 10px) scale(0.8); }
            10% { opacity: 1; transform: translate(-50%, 0) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -80px) scale(1); }
        }

        @keyframes floatUpSlow {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            20% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -100px); }
        }
    </style>
</head>
<body>

    <div class="stage">
        <!-- æ ¸å¿ƒï¼šåªæœ‰ç‹®å­ -->
        <img id="pet-image" src="" alt="Lion" draggable="false" />
    </div>

<script>
// --- æ•°æ®å¸¸é‡ (ç”¨äºåˆ¤æ–­æˆé•¿é˜¶æ®µæ˜¾ç¤ºä»€ä¹ˆå›¾ç‰‡) ---
const LION_STAGES = [
    { minMinutes: 0, assets: { idle: "https://cos-cdn.kk6277.com/feishu/img_v3_02tt_605328cb-0397-4ae6-9d8c-81d9faa9c2cg.png", touch: "https://cos-cdn.kk6277.com/feishu/img_v3_02tt_2fa9c653-032e-4056-9edb-ba6c36f99f3g.png" } },
    { minMinutes: 60, assets: { idle: "https://cos-cdn.kk6277.com/feishu/img_v3_02tc_0932da40-1ec4-4b08-bcaf-50059a9c590g.png", touch: "https://cos-cdn.kk6277.com/feishu/img_v3_02tc_8714e8cd-a493-4910-a879-a711ce2fcffg.png" } },
    { minMinutes: 1440, assets: { idle: "https://cos-cdn.kk6277.com/feishu/img_v3_02tt_68b43430-306d-4e8f-adbc-93c98b199a1g.png", touch: "https://cos-cdn.kk6277.com/feishu/img_v3_02tt_75a5ae6c-1eeb-48e4-817d-0b2a0658c98g.png" } },
    { minMinutes: 4320, assets: { idle: "https://cos-cdn.kk6277.com/feishu/img_v3_02tt_599dfcf7-4217-4ade-aede-04b3bd4674dg.png", touch: "https://cos-cdn.kk6277.com/feishu/img_v3_02tt_469cadec-c139-4113-af5c-741f1c9d19dg.png" } }
];

class SimpleWidget {
    constructor() {
        this.state = {
            points: 100,
            totalTimeSec: 0
        };
        this.currentStage = 0;
        this.animTimer = null;
        // å®šä¹‰è¢«åŠ¨æ”¶ç›Šé—´éš” (æ¯«ç§’)ï¼Œè¿™é‡Œè®¾ä¸º60ç§’
        this.PASSIVE_INTERVAL = 60000; 
    }

    init() {
        this.loadData();
        this.updateGrowthStage();
        this.preloadImages();
        
        // ç¡®ä¿å›¾ç‰‡åŠ è½½
        const petImg = document.getElementById('pet-image');
        if (!petImg.src) this.setPetState('idle');

        // 1. åŸºç¡€è®¡æ—¶å™¨ï¼šè®¡ç®—æ€»æ—¶é•¿ï¼Œæ£€æŸ¥æˆé•¿é˜¶æ®µ
        setInterval(() => {
            this.state.totalTimeSec++;
            this.updateGrowthStage();
            // æ¯5ç§’é™é»˜ä¿å­˜ä¸€æ¬¡
            if(this.state.totalTimeSec % 5 === 0) this.saveData();
        }, 1000);

        // 2. è¢«åŠ¨æ”¶ç›Šè®¡æ—¶å™¨ï¼šæ¨¡æ‹ŸæŒ‚æœºè·å¾—å¥–åŠ±
        setInterval(() => {
            this.state.points += 5;
            this.saveData();
            // åœ¨ç‹®å­å¤´é¡¶æ˜¾ç¤ºæç¤º
            this.showToast("+5 ğŸŒ¹ (é™ªä¼´å¥–åŠ±)", null, null, 'passive');
        }, this.PASSIVE_INTERVAL);
    }

    updateGrowthStage() {
        const mins = this.state.totalTimeSec / 60;
        let stageIndex = 0;
        for (let i = 0; i < LION_STAGES.length; i++) {
            if (mins >= LION_STAGES[i].minMinutes) stageIndex = i;
        }
        if (this.currentStage !== stageIndex) {
            this.currentStage = stageIndex;
            this.setPetState('idle');
        }
    }

    // --- æ ¸å¿ƒäº¤äº’é€»è¾‘ ---
    handleTouch(e) {
        let clientX = null, clientY = null;
        if (e) {
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else if (e.clientX) {
                clientX = e.clientX;
                clientY = e.clientY;
            }
        }

        // 1. å¢åŠ ç§¯åˆ†é€»è¾‘
        this.state.points += 1;
        this.saveData();
        this.setPetState('touch', 800); // æ’­æ”¾è§¦æ‘¸åŠ¨ç”»

        // 2. æ˜¾ç¤ºæ™®é€šç‚¹å‡»åé¦ˆ
        this.showToast("+1 ğŸŒ¹", clientX, clientY, 'gain');

        // 3. éšæœºè§¦å‘â€œçˆ†æ—¶é•¿â€å¥–åŠ± (2% æ¦‚ç‡)
        const bonusChance = Math.random();
        if(bonusChance > 0.98) {
            const bonusSec = Math.floor(Math.random() * 120) + 30; // å¥–åŠ± 30-150ç§’
            this.state.totalTimeSec += bonusSec;
            
            // ç¨å¾®å»¶è¿Ÿä¸€ç‚¹æ˜¾ç¤ºï¼Œé”™å¼€æ°”æ³¡
            setTimeout(() => {
                this.showToast(`âœ¨ æƒŠå–œ! æˆé•¿ +${bonusSec}ç§’`, null, null, 'bonus');
            }, 300);
        }
    }

    setPetState(stateKey, duration = 0) {
        const petImg = document.getElementById('pet-image');
        const currentAssets = LION_STAGES[this.currentStage].assets;
        const target = currentAssets[stateKey] || currentAssets.idle;
        
        if (petImg.src !== target) {
            petImg.src = target;
        }
        
        if (this.animTimer) clearTimeout(this.animTimer);
        if (duration > 0) {
            this.animTimer = setTimeout(() => {
                this.setPetState('idle');
                this.animTimer = null;
            }, duration);
        }
    }

    // --- æ¼‚æµ®æ–‡å­—æ ¸å¿ƒ ---
    showToast(text, x, y, type = 'gain') {
        const el = document.createElement('div');
        el.className = `floater ${type}`;
        el.innerText = text;
        
        if (x !== null && y !== null) {
            // åœ¨ç‚¹å‡»ä½ç½®é™„è¿‘éšæœºåç§»ä¸€ç‚¹ï¼Œé˜²æ­¢å®Œå…¨é‡å 
            const randomX = (Math.random() - 0.5) * 30;
            el.style.left = `${x + randomX}px`;
            el.style.top = `${y - 40}px`; // ç¨å¾®é ä¸Šä¸€ç‚¹
        } else {
            // å±…ä¸­ä½ç½® (ç”¨äºè¢«åŠ¨å¥–åŠ±)
            el.style.left = '50%';
            el.style.top = '40%';
            el.style.transform = 'translate(-50%, -50%)';
        }

        document.body.appendChild(el);
        // åŠ¨ç”»ç»“æŸåç§»é™¤
        setTimeout(() => el.remove(), 2000);
    }

    preloadImages() {
        LION_STAGES.forEach(stage => {
            if(stage.assets.idle) (new Image()).src = stage.assets.idle;
            if(stage.assets.touch) (new Image()).src = stage.assets.touch;
        });
    }

    saveData() {
        localStorage.setItem('lionRamadanV2', JSON.stringify(this.state));
    }

    loadData() {
        try {
            const saved = localStorage.getItem('lionRamadanV2');
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed.points !== undefined) this.state.points = parsed.points;
                if (parsed.totalTimeSec !== undefined) this.state.totalTimeSec = parsed.totalTimeSec;
            }
        } catch(e) { console.log("Load error", e); }
    }
}

const simpleWidget = new SimpleWidget();
window.onload = () => {
    simpleWidget.init();
    const img = document.getElementById('pet-image');
    img.addEventListener('mousedown', (e) => simpleWidget.handleTouch(e));
    img.addEventListener('touchstart', (e) => {
        e.preventDefault(); 
        simpleWidget.handleTouch(e);
    }, {passive: false});
};
</script>
</body>
</html>
